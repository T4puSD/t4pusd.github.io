<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Spring Boot Reactive JWT - t4pusd | Tech Blog</title><meta name="Description" content="t4pusd&#39;s Tech Blog!"><meta property="og:url" content="https://t4pusd.github.io/posts/spring_boot_reactive_jwt/">
  <meta property="og:site_name" content="t4pusd | Tech Blog">
  <meta property="og:title" content="Spring Boot Reactive JWT">
  <meta property="og:description" content="üçÉ Spring Boot Reactive With JWT Authetnication System Agenda In this blog post, we‚Äôll explore how to implement JWT authentication and authorization in a reactive way using the Spring Boot Reactive framework. üòÉ
Assuming you‚Äôre already familiar with implementing JWT authentication in a normal Spring Boot application, this blog will focus on the key differences in the implementation for a reactive application.
Before we dive into the implementation details, let‚Äôs quickly review what reactive programming is, what the Spring Boot Reactive framework is, and what JWT authentication is.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-02-13T22:08:16+06:00">
    <meta property="article:modified_time" content="2023-02-13T22:08:16+06:00">
    <meta property="article:tag" content="Spring Boot">
    <meta property="article:tag" content="Spring Boot Reactive">
    <meta property="article:tag" content="Stateless Server">
    <meta property="article:tag" content="JWT">
    <meta property="og:image" content="https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg">
  <meta name="twitter:title" content="Spring Boot Reactive JWT">
  <meta name="twitter:description" content="üçÉ Spring Boot Reactive With JWT Authetnication System Agenda In this blog post, we‚Äôll explore how to implement JWT authentication and authorization in a reactive way using the Spring Boot Reactive framework. üòÉ
Assuming you‚Äôre already familiar with implementing JWT authentication in a normal Spring Boot application, this blog will focus on the key differences in the implementation for a reactive application.
Before we dive into the implementation details, let‚Äôs quickly review what reactive programming is, what the Spring Boot Reactive framework is, and what JWT authentication is.">
<meta name="application-name" content="t4pusd | Tech Blog">
<meta name="apple-mobile-web-app-title" content="t4pusd | Tech Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://t4pusd.github.io/posts/spring_boot_reactive_jwt/" /><link rel="prev" href="https://t4pusd.github.io/posts/caddy_as_file_server/" /><link rel="next" href="https://t4pusd.github.io/posts/challenges-of-implementing-soft-delete/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Spring Boot Reactive JWT",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/t4pusd.github.io\/posts\/spring_boot_reactive_jwt\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/t4pusd.github.io\/images\/logo.png",
                            "width":  209 ,
                            "height":  210 
                        }],"genre": "posts","keywords": "Spring Boot, Spring Boot Reactive, Stateless Server, JWT","wordcount":  1144 ,
        "url": "https:\/\/t4pusd.github.io\/posts\/spring_boot_reactive_jwt\/","datePublished": "2023-02-13T22:08:16+06:00","dateModified": "2023-02-13T22:08:16+06:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Tapu Sutradhar"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="t4pusd | Tech Blog"><span class="header-title-pre"><i class='fa-regular fa-keyboard'></i>&nbsp;</span><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/">&#128424; Posts </a><a class="menu-item" href="/tags/">&#128204; Tags </a><a class="menu-item" href="/aboutme/">&#128129; About </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="t4pusd | Tech Blog"><span class="header-title-pre"><i class='fa-regular fa-keyboard'></i>&nbsp;</span><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">&#128424;Posts</a><a class="menu-item" href="/tags/" title="">&#128204;Tags</a><a class="menu-item" href="/aboutme/" title="">&#128129;About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Spring Boot Reactive JWT</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Tapu Sutradhar</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-02-13">2023-02-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1144 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg"
        data-srcset="https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg, https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg 1.5x, https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg 2x"
        data-sizes="auto"
        alt="https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg"
        title="https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#agenda">Agenda</a></li>
    <li><a href="#what-is-reactive-programming">What is reactive programming?</a></li>
    <li><a href="#what-is-spring-boot-reactive-framework-">What is Spring Boot Reactive Framework? üîã</a></li>
    <li><a href="#what-is-jwt-authentication-system-">What is JWT Authentication System? üîê</a></li>
    <li><a href="#benefits-of-using-reactive-api">Benefits of using Reactive API</a></li>
    <li><a href="#dependency-needed-to-follow-along">Dependency Needed to Follow Along</a></li>
    <li><a href="#lets-code-along-">Let&rsquo;s Code Along üöÄ</a>
      <ul>
        <li><a href="#initialize-the-project">Initialize the Project</a></li>
        <li><a href="#domains">Domains</a></li>
        <li><a href="#repository">Repository</a></li>
        <li><a href="#authentication-filter">Authentication Filter</a></li>
        <li><a href="#security-configuration">Security Configuration</a></li>
      </ul>
    </li>
    <li><a href="#project-link">Project Link</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="-spring-boot-reactive-with-jwt-authetnication-system">üçÉ Spring Boot Reactive With JWT Authetnication System</h1>
<h2 id="agenda">Agenda</h2>
<p>In this blog post, we&rsquo;ll explore how to implement JWT authentication and authorization in a reactive way using the Spring Boot Reactive framework. üòÉ</p>
<p>Assuming you&rsquo;re already familiar with implementing JWT authentication in a normal Spring Boot application, this blog will focus on the key differences in the implementation for a reactive application.</p>
<p>Before we dive into the implementation details, let&rsquo;s quickly review what reactive programming is, what the Spring Boot Reactive framework is, and what JWT authentication is.</p>
<h2 id="what-is-reactive-programming">What is reactive programming?</h2>
<p>Reactive programming is a paradigm built on the concept of streams, where data flows asynchronously between components. In this programming model, a client sends a request to the server, and the server responds with a stream of data that&rsquo;s pushed to the client as it becomes available. This approach enables more efficient use of resources, as opposed to the traditional model where a request blocks certain portions of resources until the request is fulfilled.</p>
<h2 id="what-is-spring-boot-reactive-framework-">What is Spring Boot Reactive Framework? üîã</h2>
<p>Spring Boot Reactive is a implementation of the reactive programming paradigm into web framework which makes it easy to create stand-alone, production-grade applications, and the Reactive Streams API, which enables asynchronous, non-blocking communication between components in the application.</p>
<h2 id="what-is-jwt-authentication-system-">What is JWT Authentication System? üîê</h2>
<p>JWT (JSON Web Token) is a standard for securely transmitting information between parties as a JSON object. JWT Authentication is a token-based authentication mechanism that involves the use of JWT to authenticate users.</p>
<p>In JWT Authentication, when a user logs in to an application, the server generates a token. This token is then sent to the client and is used for subsequent requests to the server to prove the user&rsquo;s identity. The server then verifies the token and allows or denies access to the requested resource based on the information contained in the token.</p>
<h2 id="benefits-of-using-reactive-api">Benefits of using Reactive API</h2>
<ul>
<li>It allowes asynchronous and non-blocking communication between components, which helps to reduce latency and increase responsiveness.</li>
<li>Improve performance by reducing the amount of blocking and increasing the parallel processing of requests.</li>
<li>It provides a solid foundation for building scalable and resilient web applications.</li>
</ul>
<h2 id="dependency-needed-to-follow-along">Dependency Needed to Follow Along</h2>
<p>These are the following dependency needed for the application which we are going to build.</p>
<ul>
<li>JDK 17</li>
<li>Maven build tool</li>
<li>An IDE (Intellij or Visual Studio Code)</li>
<li>MongoDB (I will be running inside docker)</li>
</ul>
<p>üîñ Link to the project github repo is in the bottom.</p>
<h2 id="lets-code-along-">Let&rsquo;s Code Along üöÄ</h2>
<p>First of all we need a working mongodb database for the application to work with. Because the application will store user information into the the database and interact with it.</p>
<p>Assuming you know how to use <code>Docker</code> use this following <code>docker-compose</code> file to create a mongodb instance.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mongo</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mongo:6.0.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">mongodb6</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="kc">on</span>-<span class="l">failure</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">37017</span><span class="p">:</span><span class="m">27017</span><span class="w">
</span></span></span></code></pre></div><p>This will spin up a mongodb instance inside docker container and expose port <code>37017</code> into host.</p>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Please note that it is not necessary to spin up a mongodb instance if you already have a running mongodb instance or mongodb atlas instance. (For such case don&rsquo;t forget to put your mongodb url into project&rsquo;s <code>application.yaml</code> file)</div>
        </div>
    </div>
<h3 id="initialize-the-project">Initialize the Project</h3>
<p>Head over to <a href="https://start.spring.io/" target="_blank" rel="noopener noreffer ">Spring Initializr</a> and generate a project template with the following dependencies.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/spring_boot_reactive_jwt/images/spring-initializer-short.png"
        data-srcset="/spring_boot_reactive_jwt/images/spring-initializer-short.png, /spring_boot_reactive_jwt/images/spring-initializer-short.png 1.5x, /spring_boot_reactive_jwt/images/spring-initializer-short.png 2x"
        data-sizes="auto"
        alt="/spring_boot_reactive_jwt/images/spring-initializer-short.png"
        title="image" width="747" height="329" /></p>
<p>Add <code>java-jwt</code> dependency as Additional dependencies needed for the application to work with Jeson Web Tokens <code>(JWT)</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.auth0<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>java-jwt<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>4.2.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="domains">Domains</h3>
<p>Our project will be a simple poc project so we will only have single domain in it named <code>Account</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Document</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Account</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@MongoId</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectId</span><span class="w"> </span><span class="n">uid</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Indexed</span><span class="p">(</span><span class="n">unique</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@NotEmpty</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@NotEmpty</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Roles</span><span class="o">&gt;</span><span class="w"> </span><span class="n">roles</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// getters, setters, equals, hash and other helper methods are removed for brevity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">Roles</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROLE_ADMIN</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ROLE_USER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="repository">Repository</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Repository</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">AccountRepository</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ReactiveMongoRepository</span><span class="o">&lt;</span><span class="n">Account</span><span class="p">,</span><span class="w"> </span><span class="n">ObjectId</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">Account</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findByEmail</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="authentication-filter">Authentication Filter</h3>
<p>Create a <code>JWTAuthenticationFilter.java</code> class file which will be used to authenticate and validate user with their JWT token and initialize security context for a request lifecycle in the server.</p>
<p>If you don&rsquo;t know what is the role of a filter in spring lifecycle you can see them as guard of a server blocking and filter every request that are processed in the server.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JWTAuthenticationFilter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebFilter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">HEADER_PREFIX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;Bearer &#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AuthService</span><span class="w"> </span><span class="n">authService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">JWTAuthenticationFilter</span><span class="p">(</span><span class="n">AuthService</span><span class="w"> </span><span class="n">authService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">authService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">ServerWebExchange</span><span class="w"> </span><span class="n">exchange</span><span class="p">,</span><span class="w"> </span><span class="n">WebFilterChain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resolveToken</span><span class="p">(</span><span class="n">exchange</span><span class="p">.</span><span class="na">getRequest</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasText</span><span class="p">(</span><span class="n">token</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">authService</span><span class="p">.</span><span class="na">verifyJWT</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">account</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UsernamePasswordAuthenticationToken</span><span class="p">(</span><span class="n">account</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="na">getGrantedAuthorities</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">authToken</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">exchange</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                            </span><span class="p">.</span><span class="na">contextWrite</span><span class="p">(</span><span class="n">ReactiveSecurityContextHolder</span><span class="p">.</span><span class="na">withAuthentication</span><span class="p">(</span><span class="n">authToken</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">exchange</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">resolveToken</span><span class="p">(</span><span class="n">ServerHttpRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">bearerToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeaders</span><span class="p">().</span><span class="na">getFirst</span><span class="p">(</span><span class="n">HttpHeaders</span><span class="p">.</span><span class="na">AUTHORIZATION</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasText</span><span class="p">(</span><span class="n">bearerToken</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bearerToken</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="n">HEADER_PREFIX</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">bearerToken</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">7</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="security-configuration">Security Configuration</h3>
<p>Create a class <code>SecurityConfig.java</code> configuration bean and declare 3 beans inside the class</p>
<p><strong>1. PasswordEncoder Bean:</strong><br>
The bean which will be responsible for encoding and comparing raw passwords with the encrypted password. This will ensure even if our application and database gets compromised hacker won&rsquo;t be able to see user&rsquo;s passwords.</p>
<p><strong>2. UserDetailsService Bean:</strong><br>
User details service bean will provide the implementation by which spring security will be able to retrive user information from database during the authentication process.</p>
<p><strong>3. SecurityWebFilterChain Bean:</strong><br>
This is a security filter chain bean which will expose all security configuration of the server. We can also set the authorization rules of api endpoints from here.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableWebFluxSecurity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SecurityConfig</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">AccountRepository</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SecurityConfig</span><span class="p">(</span><span class="n">AccountRepository</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">accountRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PasswordEncoder</span><span class="w"> </span><span class="nf">passwordEncoder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BCryptPasswordEncoder</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ReactiveUserDetailsService</span><span class="w"> </span><span class="nf">userDetailsService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">accountRepository</span><span class="p">.</span><span class="na">findByEmail</span><span class="p">(</span><span class="n">username</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">account</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getEmail</span><span class="p">(),</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="na">getPassword</span><span class="p">(),</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="na">getGrantedAuthorities</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SecurityWebFilterChain</span><span class="w"> </span><span class="nf">securityFilterChain</span><span class="p">(</span><span class="n">ServerHttpSecurity</span><span class="w"> </span><span class="n">http</span><span class="p">,</span><span class="w"> </span><span class="n">AuthService</span><span class="w"> </span><span class="n">authService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">http</span><span class="p">.</span><span class="na">csrf</span><span class="p">(</span><span class="n">ServerHttpSecurity</span><span class="p">.</span><span class="na">CsrfSpec</span><span class="p">::</span><span class="n">disable</span><span class="p">)</span><span class="w"> </span><span class="c1">// disabled for stateless server configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">httpBasic</span><span class="p">(</span><span class="n">httpBasicSpec</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c1">// any kind of authentication exception will return 401 response</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="n">httpBasicSpec</span><span class="p">.</span><span class="na">authenticationEntryPoint</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">HttpStatusServerEntryPoint</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNAUTHORIZED</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">authorizeExchange</span><span class="p">(</span><span class="n">exchange</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">exchange</span><span class="p">.</span><span class="na">pathMatchers</span><span class="p">(</span><span class="s">&#34;/api/admin/**&#34;</span><span class="p">).</span><span class="na">hasRole</span><span class="p">(</span><span class="s">&#34;ADMIN&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">pathMatchers</span><span class="p">(</span><span class="s">&#34;/api/auth/**&#34;</span><span class="p">).</span><span class="na">permitAll</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="p">.</span><span class="na">anyExchange</span><span class="p">().</span><span class="na">authenticated</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">addFilterAt</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JWTAuthenticationFilter</span><span class="p">(</span><span class="n">authService</span><span class="p">),</span><span class="w"> </span><span class="n">SecurityWebFiltersOrder</span><span class="p">.</span><span class="na">HTTP_BASIC</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Notice that we are using the <code>JWTAuthenticationFilter</code> we created earlier to replace <code>HTTP_BASIC</code> authentication filter.</p>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>Note<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Keep in mind that if you don&rsquo;t use this <code>@EnableWebFluxSecurity</code> annotation in the bean class your security filter won&rsquo;t take effect at all. This annotation is necessary to initialize the security filter chian for spring boot reactive.</div>
        </div>
    </div>
<h2 id="project-link">Project Link</h2>
<p>You can find the full source code of the project in my github repository. Here is the link <a href="https://github.com/T4puSD/reactive-spring-rest-jwt" target="_blank" rel="noopener noreffer ">https://github.com/T4puSD/reactive-spring-rest-jwt</a></p>
<h2 id="conclusion">Conclusion</h2>
<p>In this blog post, we&rsquo;ve explored what is Reactive Programming, what is JWT and how we can use it to secure a web application, and learned how to implement Spring Boot Security in a reactive paradigm. While Spring Boot is designed for traditional request/response web applications, Spring Reactive allows you to build more efficient and scalable reactive web applications. With the Spring Security Reactive module, you can easily secure your reactive endpoints and ensure that your application is safe and secure.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-02-13</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://t4pusd.github.io/posts/spring_boot_reactive_jwt/" data-title="Spring Boot Reactive JWT" data-hashtags="Spring Boot,Spring Boot Reactive,Stateless Server,JWT"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://t4pusd.github.io/posts/spring_boot_reactive_jwt/" data-hashtag="Spring Boot"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://t4pusd.github.io/posts/spring_boot_reactive_jwt/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://t4pusd.github.io/posts/spring_boot_reactive_jwt/" data-title="Spring Boot Reactive JWT"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on ÂæÆÂçö" data-sharer="weibo" data-url="https://t4pusd.github.io/posts/spring_boot_reactive_jwt/" data-title="Spring Boot Reactive JWT" data-image="https://cdn.pixabay.com/photo/2016/04/24/17/27/leaves-1350175_960_720.jpg"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/spring-boot/">Spring Boot</a>,&nbsp;<a href="/tags/spring-boot-reactive/">Spring Boot Reactive</a>,&nbsp;<a href="/tags/stateless-server/">Stateless Server</a>,&nbsp;<a href="/tags/jwt/">JWT</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/caddy_as_file_server/" class="prev" rel="prev" title="Caddy As File Server"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Caddy As File Server</a>
            <a href="/posts/challenges-of-implementing-soft-delete/" class="next" rel="next" title="Challenges of Implementing Soft Delete">Challenges of Implementing Soft Delete<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.147.8">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Tapu Sutradhar</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"data":{"id-1":"t4pusd","id-2":"t4pusd"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
